<!--
    *** DEVELOPER NOTE: FIX FOR 'auth/unauthorized-domain' ERROR ***
    
    If you are seeing a 'Firebase: Error (auth/unauthorized-domain)' error in your console,
    it is NOT a bug in this code. It is a security setting in your Firebase project.

    Here is the step-by-step fix:
    1. Go to the Firebase Console: https://console.firebase.google.com/
    2. Select your project: 'timelesswhispers-37f98'
    3. Go to 'Authentication' (in the left-hand menu).
    4. Go to the 'Settings' tab (at the top of the Authentication page).
    5. Find the 'Authorized domains' list.
    6. Click 'Add domain'.
    7. Type in your website's domain: flynn-maxwel.github.io
    8. Click 'Add'.

    Wait 1-2 minutes, then reload your website. The error will be gone and sign-in will work.
-->
<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeless Whispers</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900&family=Lora:ital,wght@0,400..700;1,400..700&family=Raleway:wght@300;400;500&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            getDocs, 
            doc, 
            getDoc, 
            setDoc, 
            serverTimestamp,
            updateDoc,
            arrayUnion,
            arrayRemove,
            onSnapshot,
            orderBy
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // *** FIREBASE CONFIG ***
        // Restored your original, hardcoded Firebase configuration.
        const firebaseConfig = {
            apiKey: "AIzaSyCsufbKfJcNZ40aDXDNXgHI-QphkFmXi-0",
            authDomain: "timelesswhispers-37f98.firebaseapp.com",
            projectId: "timelesswhispers-37f98",
            storageBucket: "timelesswhispers-37f98.firebasestorage.app",
            messagingSenderId: "632234683017",
            appId: "1:632234683017:web:04f44be51fa2f88075b458",
            measurementId: "G-PLN3R3YSCX"
        };
        
        // Use your project ID for database paths
        const appId = firebaseConfig.projectId;

        // *** GLOBAL FIREBASE & AUTH STATE ***
        let db, auth;
        let currentUserId = null;
        let currentUserName = null; // Store the user's display name

        // --- DATA & CONSTANTS ---
        const poems = [
            { id: 1, title: 'The Eyes of Her Soul', emotion: 'Love', content: `The secrets of her soul are reflected in her eyes,\nWhich are like two pools of liquid light.\nDeep within them lies an untold universe,\nA beautifully scrolled story of emotions.\n\nJust a quick look can captivate me\nAnd transport me to the depths of her stunning eyes.\nA glimpse of the calm and perceptive soul,\nA kaleidoscope of emotions and invisible colors.` },
            { id: 2, title: 'In Her Presence', emotion: 'Love', content: `The sun is not as bright when I am not with her.\nIn her absence, the clouds are ominous and threatening.\nThe birds’ singing becomes less melodious\nWhen I am not around her.\n\nI feel like the walls close in on me\nWhen I’m not with her.\nWhispering her name keeps me going\nWhen I am desolate and without her.\n\nBut she gives me a boost when we are together.\nIn her presence, I possess the strength to move mountains.\nI am capable of withstand-ing anything\nWhen I am with her.\n\nWhen we are together,\nHer smile makes me feel so happy.\nThe angels sing her name\nWhen we are together.\n\nI fall in love all over again\nWhen we are together.` },
            { id: 3, title: 'The Lips of Desire', emotion: 'Chaos', content: `The lips are sweet.\nI am not sure how to touch them.\nThat enslaves me with their grandeur.\nI wondered if I should see them near.\nUpper and lower are so tender.\nWhen together makes me happy.\nThey yearn to be perceived when drenched.\nThey want to be embraced.\nThe lips laugh.\nYour prongs make me look.\nThe lips that moan and the lips that sigh.\nIt takes me to a high.\nI want to have a child within my imprisoned wish.\nlaugh at the way they deceive.\nWords whisper, I want to hear them.\nI have to keep the memories in tact.\nThe lips of love and the lips of ire.\nThe lips were sweet and on fire.\nThere are lips of golden heavenly mire.\nI hope they don’t leave me in a bad situation.` },
            { id: 4, title: 'When We First Met', emotion: 'Love', content: `The moment we first met,\nI knew we were meant to be.\nWe were destined to be together,\nAnd I knew you were the one.\n\nI had no idea who you were.\nAll I knew was your name.\nI had no idea what to do.\nI couldn’t decide who was at fault.\n\nI was aware of my attraction to you.\nYou seemed like a good person to me.\nThe butterflies were moving so quickly\nThat I had to stop and consider.\n\nNothing I did that day\nRevealed who I am to you.\nMy heart started to race\nEvery time you approached me.\n\nMy behavior wasn’t typical.\nMy responses weren’t sincere.\nI couldn’t control my heart,\nEven though I felt so awful.\n\nAnd you were the center of my attention\nWhen the group bid me farewell.\nI knew I was attempting to find out\nIf you shared my sentiments.\n\nWhen I saw your face,\nI liked you; however,\nIt might inave been the touch.\nMy heart was racing already.\n\nI was already too fond of you.\nThe moment we first met,\nI knew we were meant to be.\nI was aware that we were destined to be\nEnemies, lovers, and friends.` },
            { id: 5, title: 'A Love Divinely Crafted', emotion: 'Hope', content: `Though I’ve always known that love would find me eventually,\nI had no idea that it would be you.\nIn the same way that you captivate me when I gaze into your eyes,\nYou caught me off guard and took me by surprise.\n\nIt is a fact that all excellent and flawless gifts\nCome from above.\nI was given you as a gorgeously wrapped gift,\nFull of intelligence, humor, talent, beauty, and love.\n\n“Learning to see an imperfect person perfectly\nIs more important than searching for the ideal person.”\nWe all have imperfections,\nBut from my perspective, you are flawless.\n\nI still enjoy the small things you do,\nLike hearing you laugh and noticing how your nose wrinkles,\nEven when you’re upset, as well.\nI’m confident that we can accomplish anything\nAs long as we’re traveling this path together.\n\nI occasionally question whether what we have is too good to be true.\nI’m afraid of losing you and of having my heart broken,\nBut ultimately, I put my trust in the one who created and perfected what I believe,\nBecause He will grant us our requests.\n\nAs they say, “Where your treasure is, your heart will be also.”\nGod alone knows what tomorrow will bring, so I may not know.\nAll I know is that you are my one and only.\n\nGod made everything beautiful, precious, and new,\nJust as beautiful and precious as the day will be,\nWhen I look into your eyes and say,\n“I Love You.”` },
            { id: 6, title: 'The Essence of Love', emotion: 'Love', content: `To love is a journey through life, hand in hand,\nTo craft dreams that belong to just us two,\nTo labor together, side by side,\nAnd bask in the joy,\nAs one by one, our aspirations unfold.\n\nTo love is to uplift and inspire,\nWith warm smiles and heartfelt words of encouragement,\nTo carve out moments to connect,\nTo listen and nurture\nIn gentle, loving ways.\n\nTo love is to cherish someone unique,\nA steadfast presence through the passage of time,\nSharing both laughter and sorrow,\nAs a partner, a confidant, a beloved friend.\n\nTo love is to create cherished memories,\nOf moments that bring joy to our hearts,\nOf all the beautiful gifts\nThat life shared together offers. Love is the ultimate treasure.\n\nI’ve discovered the true essence\nOf sharing and caring,\nAnd new witnessing my dreams blossom;\nI’ve embraced the full meaning\nOf being in love\nBy simply being and loving you.` },
            { id: 7, title: 'I Will Always Love You', emotion: 'Hope', content: `Even though you will occasionally annoy me and make me feel angry,\n“I will always love you.”\n\n“I will always love you, even though there are some hurtful things you might say\nThat will make me sad.”\n\nI will always love you,\nEven though I know that you will disappoint me with some foolish choices.\n\n“I will always love you, even though there are things you might do\nThat make me worry about you.”\n\n“I will always love you, even though there will be times\nWhen you will bring me to tears.”\n\n“You will make mistakes that I cannot forgive,\nBut I will always love you regardless.”\n\nI will always love you,\nDespite the lies you tell me to try to undermine my faith in you.\n\n“I want you to know that, despite the difficulties,\nDisagreements, and trials we will face in life,\n‘I will always love you,’ both now and in the future.”` },
            { id: 8, title: 'In the Shadow of Your Presence', emotion: 'Silent Nights', content: `In a world where I’ve never asked for anything,\nI find myself in awe of how everything feels complete,\nFor you belong to me.\nYour presence alone fills my heart,\nAnd without you, this world loses its meaning.\nIt’s as if the universe conspired to bring us together,\nCrafting moments that shimmer with the essence of what could be.\nEach day unfolds like a page in a story\nThat I never knew I was longing to write,\nAnd you are the ink that brings it to life.\n\nIn my dreams, there exists a sacred space\nWhere it’s just you and me, untouched by anyone else.\nA realm where time stands still,\nAnd the outside world fades into a distant memory.\nOh, how I long for you to arrive!\nThe anticipation of your presence is a melody\nThat plays softly in my heart,\nA song that echoes through the corridors of my mind.\nAre our destinies woven together in this beautiful tapestry?\nEach thread a promise, each color a memory waiting to be made.\nIf our paths were to cross,\nI would fall hopelessly in love with you,\nSurrendering to the gravity of your essence.\nEven if fate keeps us apart, my heart will still yearn for you,\nFor you are mine—a truth that resonates deep within my soul.\n\nYou wonder what I see in you amidst the beauty that surrounds us.\nLittle do you know, you are the most captivating sight of all.\nPlease, look at yourself through my eyes.\nBeneath your hair lies a radiant smile,\nA beacon of warmth that lights up even the darkest corners of my heart.\nYour eyes dance with a light that draws me in,\nSparkling with a thousand unspoken stories,\nEach one more enchanting than the last.\n\nWhat can I say about your lips,\nThe ones that whisper sweet names to me?\nThey hold the power to ignite a fire within me,\nA warmth that spreads through my veins like a gentle flame.\nAnd your heart—oh, how magnificent it is!\nIt beats with a rhythm that harmonizes with my own,\nA symphony of emotions that transcends the ordinary.\n\nPicture us, two hearts walking hand in hand,\nNavigating the world together,\nEach step a testament to our connection.\nWill the sky be clear, or will it rain?\nEven if the clouds gather, I would be by your side,\nFor you are my everything.\nIn the storm, I would find solace in your embrace,\nAnd in the sunshine, I would bask in the glow of your laughter.\n\nTogether, we would create a universe of our own,\nA sanctuary.` },
            { id: 9, title: 'A Soul Shattered by Love', emotion: 'Loss', content: `How can I mend a shattered soul?\nMy entire existence has crumbled.\nHow can I find solace in a new beginning,\nWhen the person I cherish is no longer present?\n\nMy thoughts are consumed by memories of you,\nOf all we’ve experienced, all we shared.\nI long for your touch and your comforting embrace,\nThe look in your eyes, the smile on your lips.\n\nMy dreams are filled with the tender kiss of yours.\nI wake up and weep for what I’ve lost.\nHow can I heal a broken heart,\nWhen my one true love and I are apart?\n\nMy heart is destined to love only you,\nIt refuses to let go, what should I do?\nOur moments together were rare and precious,\nBut I treasured them more than you could ever know.\n\nI love you, my angel, and always will.\nI felt love for you then, and I feel it still.` },
            { id: 10, title: 'Under the Moonlit Spell', emotion: 'Love', content: `Beneath the glimmering moonlight,\nUnder a blanket of stars,\nI find myself intertwined with you\nIn a faraway place that feels like ours.\n\nThe world is silent,\nAnd all I can sense\nIs the soft rhythm of our shared breaths.\nYou have me enchanted, my heart tightly ensnared,\nLost in your essence, where true love is declared.\n\nYour lips graze my neck,\nIgniting a flame,\nEach gentle touch\nStokes my desire’s name.\n\nAs my body awakens,\nIt yearns for your caress,\nLonging for your embrace,\nCraving you more and more, I confess.\n\nWith every movement,\nA smile dances on my face,\nShould I whisper sweet nothings\nOr let passion take its place?\n\nYou tug at my hair,\nLifting me high,\nFloating on clouds,\nAs if we could soar through the sky.\n\nAs I shiver and tremble,\nOur hearts begin to race,\nIn this moonlit sanctuary,\nI’m yours in this space.` },
        ];
        const emotions = ['All', 'Favorites', 'Love', 'Loss', 'Hope', 'Healing', 'Chaos', 'Silent Nights'];
        
        // --- PAGE SCRIPT ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- STATE MANAGEMENT ---
            let currentTheme = 'light';
            let activeFilter = 'All';
            let favoritePoemIds = []; // This will be populated from Firestore
            let currentOpenPoemId = null;

            // --- DOM ELEMENTS ---
            const docElement = document.documentElement;
            const body = document.body;
            const topNav = document.getElementById('top-nav');
            const emotionFiltersContainer = document.getElementById('emotion-filters');
            const poemsGrid = document.getElementById('poems-grid');
            const modal = document.getElementById('quick-preview-modal');
            const modalContent = document.getElementById('modal-poem-content');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const themeToggleButton = document.getElementById('theme-toggle');
            
            // Auth DOM Elements
            const navAuth = document.getElementById('nav-auth');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userName = document.getElementById('user-name');

            // Feedback DOM Elements
            const postReviewBtn = document.getElementById('post-review-btn');
            const reviewText = document.getElementById('review-text');
            const reviewMessage = document.getElementById('review-message');
            const postSubmissionBtn = document.getElementById('post-submission-btn');
            const submissionTitle = document.getElementById('submission-title');
            const submissionContent = document.getElementById('submission-content');
            const submissionMessage = document.getElementById('submission-message');
            const feedbackAuthPrompt = document.getElementById('feedback-auth-prompt');
            const feedbackForms = document.getElementById('feedback-forms');


            // --- SVG ICONS ---
            const SunIcon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m4.93 19.07 1.41-1.41"></path><path d="m17.66 6.34 1.41-1.41"></path></svg>`;
            const MoonIcon = `<svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>`;
            const HeartIconOutline = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>`;
            const HeartIconFilled = `<svg class="w-6 h-6 heart-filled" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 20.364l-7.682-7.682a4.ssp 4.5 0 010-6.364z"></path></svg>`;
            const ShareIcon = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>`;

            // --- RENDER FUNCTIONS ---
            
            function renderFilters() {
                emotionFiltersContainer.innerHTML = emotions.map(emotion => `
                    <button data-filter="${emotion}" class="filter-btn py-2 px-5 rounded-full text-sm transition-all duration-300 ${activeFilter === emotion ? 'active text-[var(--c-bg)]' : 'border'}" style="${activeFilter === emotion ? `background-color: var(--c-accent-1); border-color: var(--c-accent-1);` : `border-color: var(--c-accent-2); color: var(--c-text);`}">
                        ${emotion}
                    </button>
                `).join('');
                emotionFiltersContainer.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        activeFilter = btn.dataset.filter;
                        renderFilters();
                        renderPoemsGrid();
                    });
                });
            }

            function renderPoemsGrid() {
                let filteredPoems;
                if (activeFilter === 'All') {
                    filteredPoems = poems;
                } else if (activeFilter === 'Favorites') {
                    filteredPoems = poems.filter(p => favoritePoemIds.includes(p.id));
                } else {
                    filteredPoems = poems.filter(p => p.emotion === activeFilter);
                }
                
                if (filteredPoems.length === 0 && activeFilter === 'Favorites') {
                    poemsGrid.innerHTML = `<p class="col-span-full text-center opacity-70">You haven't favorited any poems yet. Click the heart icon on a poem to save it here.</p>`;
                    return;
                }

                poemsGrid.innerHTML = filteredPoems.map(poem => `
                    <div class="poem-card p-6 rounded-lg" style="background-color: var(--c-bg); border: 1px solid var(--c-accent-2);">
                        <div class="flex justify-between items-start">
                            <div class="cursor-pointer flex-grow" data-poem-id="${poem.id}">
                                <h3 class="font-headline text-xl font-bold" style="color: var(--c-accent-1);">${poem.title}</h3>
                                <p class="mt-2 opacity-70 italic">"${poem.content.split('\n')[0]}"</p>
                                <p class="opacity-70 italic">"${poem.content.split('\n')[1]}"</p>
                            </div>
                            <button class="favorite-btn p-2 -mr-2 -mt-2 opacity-50 hover:opacity-100 transition-opacity" data-poem-id="${poem.id}">
                                ${favoritePoemIds.includes(poem.id) ? HeartIconFilled : HeartIconOutline}
                            </button>
                        </div>
                    </div>
                `).join('');

                poemsGrid.querySelectorAll('.poem-card > div > div').forEach(card => {
                    card.addEventListener('click', () => showPoemModal(card.dataset.poemId));
                });
                poemsGrid.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(btn.dataset.poemId, btn);
                    });
                });
            }

            function showPoemModal(poemId) {
                const poem = poems.find(p => p.id == poemId);
                if (poem) {
                    currentOpenPoemId = poem.id; // Set current poem ID

                    modalContent.innerHTML = `
                        <div class="flex justify-between items-start gap-4">
                            <div>
                                <h2 class="font-headline text-3xl font-bold mb-2" style="color: var(--c-highlight);">${poem.title}</h2>
                                ${poem.subtitle ? `<p class="italic opacity-60 mb-8">${poem.subtitle}</p>` : '<div class="mb-8"></div>'}
                            </div>
                            <div class="flex-shrink-0 flex items-center gap-4">
                                <!-- Share Button -->
                                <button id="shareButton" onclick="sharePoem()" class="flex items-center gap-1 py-1 px-2 rounded-full text-sm transition-all duration-300 opacity-70 hover:opacity-100" style="color: var(--c-highlight);">
                                    ${ShareIcon} Share
                                </button>
                                <!-- Like Button and Count -->
                                <div class="flex items-center gap-1 opacity-80">
                                    <button id="likeButton" onclick="likePost()" class="py-1 px-2 rounded-full text-sm transition-all duration-300 disabled:opacity-60" style="color: var(--c-highlight);">
                                        ❤️ Like
                                    </button>
                                    <span id="likeCount" class="text-sm font-bold" style="color: var(--c-highlight);">0</span>
                                </div>
                                <button class="favorite-btn p-2 opacity-50 hover:opacity-100 transition-opacity" data-poem-id="${poem.id}">
                                    ${favoritePoemIds.includes(poem.id) ? HeartIconFilled : HeartIconOutline}
                                </button>
                            </div>
                        </div>
                        <div class="whitespace-pre-wrap leading-relaxed">${poem.content.replace(/\n/g, '<br>')}</div>
                        
                        <!-- Reflections Section -->
                        <div class="mt-12 pt-8 border-t" style="border-color: var(--c-accent-2)">
                            <h3 class="font-headline text-xl font-bold mb-4" style="color: var(--c-accent-1);">Reflections</h3>
                            
                            <!-- Comment Form -->
                            <div id="comment-form-container" class="mb-6">
                                <p id="comment-signin-prompt" class="hidden opacity-70">
                                    <button class="font-bold underline" style="color: var(--c-accent-1);" onclick="googleLogin()">Sign in</button> to leave a reflection.
                                </p>
                                <div id="comment-form" class="hidden">
                                    <textarea id="comment" placeholder="Your thoughts..." class="w-full p-3 h-24 rounded-lg border-2 focus:ring-2 outline-none transition-shadow" style="background-color: var(--c-bg); border-color: var(--c-accent-2); color: var(--c-text); --tw-ring-color: var(--c-accent-1);"></textarea>
                                    <button onclick="postComment()" class="mt-2 font-bold py-2 px-5 rounded-full shadow-lg hover:opacity-90 transition-all text-sm" style="background-color: var(--c-accent-1); color: var(--c-bg);">Post</button>
                                </div>
                            </div>
                            
                            <!-- Comment List -->
                            <div id="list" class="space-y-4 max-h-60 overflow-y-auto">
                                <!-- Comments will be loaded here -->
                            </div>
                        </div>
                    `;
                    modal.classList.add('visible');
                    
                    // Add event listeners for modal elements
                    const modalFavoriteBtn = modal.querySelector('.favorite-btn');
                    modalFavoriteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleFavorite(e.currentTarget.dataset.poemId, modalFavoriteBtn);
                    });
                    
                    // Check auth state for comment form
                    checkAuthForComments(auth.currentUser);
                    // Load comments for this poem
                    loadComments(poem.id);
                    // Load likes for this poem
                    loadLikes(poem.id);
                    // Load favorite status for this poem (using current user)
                    loadFavoriteStatus(poem.id, auth.currentUser);
                }
            }

            function renderThemeToggle() {
                themeToggleButton.innerHTML = currentTheme === 'light' ? MoonIcon : SunIcon;
            }

            // --- CORE LOGIC ---
            function toggleTheme() {
                body.classList.add('theme-transition'); 
                setTimeout(() => {
                    docElement.classList.toggle('dark');
                    docElement.classList.toggle('light');
                    currentTheme = docElement.classList.contains('dark') ? 'dark' : 'light';
                    
                    renderFilters();
                    renderPoemsGrid();
                    renderThemeToggle();
                    
                    body.classList.remove('theme-transition');
                }, 500);
            }

            // --- AUTH FUNCTIONS ---
            const provider = new GoogleAuthProvider();

            window.googleLogin = function(){
                // The 'auth/unauthorized-domain' error is a FIREBASE SETTINGS issue.
                // See note at top of this file for the fix.
                signInWithPopup(auth, provider)
                .then(result => {
                    console.log("Logged in as " + result.user.displayName);
                    // Save user data to Firestore
                    saveUser(result.user);
                })
                .catch(err => console.error("Google Sign-In Error:", err.code, err.message));
            }

            window.googleLogout = function(){
                signOut(auth).then(() => {
                    console.log("Logged out");
                    favoritePoemIds = []; // Clear local favorites on logout
                    renderPoemsGrid(); // Re-render grid
                }).catch(err => console.error("Sign Out Error:", err));
            }

            let userFavoritesUnsubscribe = null; // To store the onSnapshot listener

            async function saveUser(u){
                // Correct path to user's private doc
                const userRef = doc(db, "artifacts", appId, "users", u.uid);
                try {
                    await setDoc(userRef, {
                        name: u.displayName,
                        email: u.email,
                        photo: u.photoURL
                    }, { merge: true }); // merge:true to not overwrite favorites
                } catch (e) {
                    console.error("Error saving user: ", e);
                }
            }

            // --- SHARE FUNCTION ---
            window.sharePoem = function() {
                const poem = poems.find(p => p.id == currentOpenPoemId);
                if (!poem) return;
                
                if (navigator.share) {
                    navigator.share({
                        title: poem.title,
                        text: `Check out this poem by Max: "${poem.title}"`,
                        url: window.location.href // Shares the main site URL
                    })
                    .then(() => console.log('Successful share'))
                    .catch((error) => console.log('Error sharing', error));
                } else {
                    console.log('Web Share API not supported.');
                    // Fallback: you could copy a link to the clipboard here
                }
            }


            // --- FAVORITE FUNCTIONS (Merged from "Save") ---

            async function toggleFavorite(poemId, targetButton) {
                if (!currentUserId) {
                    console.error("Login first to favorite a post.");
                    window.googleLogin(); // Prompt login
                    return;
                }
                const id = parseInt(poemId);
                const poemIdStr = id.toString();
                
                // Correct path to user's private doc
                const userRef = doc(db, "artifacts", appId, "users", currentUserId);

                // Optimistic UI update
                const isFavorited = favoritePoemIds.includes(id);
                if (isFavorited) {
                    favoritePoemIds = favoritePoemIds.filter(favId => favId !== id);
                } else {
                    favoritePoemIds.push(id);
                }
                // Update all matching buttons
                updateAllFavoriteButtons(poemId, !isFavorited);

                try {
                    // Update Firestore
                    // Create the doc if it doesn't exist, using setDoc with merge
                    await setDoc(userRef, {
                        favoritePoemIds: isFavorited ? arrayRemove(poemIdStr) : arrayUnion(poemIdStr)
                    }, { merge: true });
                    // Note: onSnapshot will fire and sync the state,
                    // but the optimistic update makes it feel instant.
                } catch (e) {
                    console.error("Error toggling favorite: ", e);
                    // Revert UI on error
                    if (isFavorited) {
                        favoritePoemIds.push(id);
                    } else {
                        favoritePoemIds = favoritePoemIds.filter(favId => favId !== id);
                    }
                    updateAllFavoriteButtons(poemId, isFavorited);
                }
            }

            function updateAllFavoriteButtons(poemId, isFavorited) {
                const buttons = document.querySelectorAll(`.favorite-btn[data-poem-id="${poemId}"]`);
                buttons.forEach(btn => {
                    btn.innerHTML = isFavorited ? HeartIconFilled : HeartIconOutline;
                });
            }

            async function loadFavoriteStatus(poemId, user) {
                // This function is now mostly handled by the real-time onSnapshot listener.
                // We just need to ensure the button's initial state is correct.
                const id = parseInt(poemId);
                const isFavorited = favoritePoemIds.includes(id);
                const modalFavoriteBtn = modal.querySelector(`.favorite-btn[data-poem-id="${poemId}"]`);
                if (modalFavoriteBtn) {
                    modalFavoriteBtn.innerHTML = isFavorited ? HeartIconFilled : HeartIconOutline;
                }
            }


            // --- LIKE FUNCTIONS ---

            window.likePost = async function() {
                if (!currentUserId) {
                    console.error("Login first to like a post.");
                    window.googleLogin(); // Prompt login
                    return;
                }
                if (!currentOpenPoemId) {
                    console.error("No poem ID is set.");
                    return;
                }

                const likeButton = document.getElementById("likeButton");
                likeButton.disabled = true; // Disable to prevent spam

                const poemIdStr = currentOpenPoemId.toString();
                
                // Correct Firestore Path
                const likesRef = collection(db, "artifacts", appId, "public", "data", "likes");
                const q = query(likesRef, where("poemId", "==", poemIdStr), where("userId", "==", currentUserId));

                try {
                    const querySnapshot = await getDocs(q);
                    if (!querySnapshot.empty) {
                        console.log("You have already liked this post.");
                        likeButton.textContent = "❤️ Liked";
                        return; // Already liked
                    }

                    // User hasn't liked it, so add a new like document
                    await addDoc(likesRef, {
                        poemId: poemIdStr,
                        userId: currentUserId,
                        timestamp: serverTimestamp()
                    });

                    // Real-time listener will update the count.
                    likeButton.textContent = "❤️ Liked";

                } catch (e) {
                    console.error("Error liking post: ", e);
                    likeButton.disabled = false; // Re-enable on error
                }
            }

            let likesUnsubscribe = null; // To store the onSnapshot listener

            window.loadLikes = async function(poemId) {
                const likeCountSpan = document.getElementById("likeCount");
                const likeButton = document.getElementById("likeButton");
                if (!likeCountSpan || !likeButton) return;

                const poemIdStr = poemId.toString();
                // Correct Firestore Path
                const likesRef = collection(db, "artifacts", appId, "public", "data", "likes");
                const q = query(likesRef, where("poemId", "==", poemIdStr));

                // Detach old listener
                if (likesUnsubscribe) likesUnsubscribe();

                // 1. Get total like count in real-time
                likesUnsubscribe = onSnapshot(q, (snapshot) => {
                    likeCountSpan.textContent = snapshot.size;

                    // 2. Check user's like status within the snapshot
                    if (currentUserId) {
                        const userLiked = snapshot.docs.some(doc => doc.data().userId === currentUserId);
                        if (userLiked) {
                            likeButton.disabled = true;
                            likeButton.textContent = "❤️ Liked";
                        } else {
                            likeButton.disabled = false;
                            likeButton.textContent = "❤️ Like";
                        }
                    } else {
                        likeButton.disabled = true;
                        likeButton.textContent = "❤️ Sign in to like";
                    }
                }, (error) => {
                    console.error("Error listening to likes: ", error);
                });
            }


            // --- COMMENT FUNCTIONS ---
            
            function checkAuthForComments(user) {
                const commentForm = document.getElementById('comment-form');
                const signinPrompt = document.getElementById('comment-signin-prompt');
                if (!commentForm || !signinPrompt) return; // Modal not open

                if (user) {
                    commentForm.classList.remove('hidden');
                    signinPrompt.classList.add('hidden');
                } else {
                    commentForm.classList.add('hidden');
                    signinPrompt.classList.remove('hidden');
                }
            }

            window.postComment = async function(){
                if(!currentUserId || !currentUserName) {
                    console.error("Login first!");
                    window.googleLogin();
                    return;
                }
                if(!currentOpenPoemId) {
                    console.error("No poem ID selected.");
                    return;
                }

                let textEl = document.getElementById("comment");
                let text = textEl.value;
                if (!text.trim()) return; // Don't post empty comments

                try {
                    // Correct Firestore Path
                    await addDoc(collection(db, "artifacts", appId, "public", "data", "comments"), {
                        poemID: currentOpenPoemId.toString(),
                        userID: currentUserId,
                        userName: currentUserName, // Save the user's first name
                        text: text,
                        parentID: null,
                        createdAt: serverTimestamp() // Use server timestamp
                    });
                    
                    console.log("Comment posted!");
                    textEl.value = ""; // Clear textarea
                    // Real-time listener will update the list
                } catch (e) {
                    console.error("Error posting comment: ", e);
                }
            };
            
            let commentsUnsubscribe = null; // To store the onSnapshot listener

            window.loadComments = async function(poemId){
                const list = document.getElementById('list');
                if (!list) return; // Exit if modal isn't open
                list.innerHTML = "<p class='opacity-50'>Loading reflections...</p>";
                
                // Detach old listener
                if (commentsUnsubscribe) commentsUnsubscribe();

                try {
                    const q = query(
                        collection(db, "artifacts", appId, "public", "data", "comments"), 
                        where("poemID", "==", poemId.toString()),
                        orderBy("createdAt", "desc") // Order by timestamp, newest first
                    );
                    
                    commentsUnsubscribe = onSnapshot(q, (querySnapshot) => {
                        let comments = [];
                        querySnapshot.forEach(doc => {
                            comments.push(doc.data());
                        });
                        renderComments(comments);
                    }, (error) => {
                        console.error("Error listening to comments: ", error);
                        list.innerHTML = "<p style='color: var(--c-highlight);'>Error loading reflections.</p>";
                    });
                    
                } catch (e) {
                    console.error("Error loading comments: ", e);
                    list.innerHTML = "<p style='color: var(--c-highlight);'>Error loading reflections.</p>";
                }
            }

            function renderComments(comments) {
                const list = document.getElementById('list');
                if (!list) return;

                if (comments.length === 0) {
                    list.innerHTML = "<p class='opacity-50'>Be the first to leave a reflection.</p>";
                    return;
                }
                
                list.innerHTML = comments.map(c => {
                    const time = c.createdAt ? new Date(c.createdAt.seconds * 1000).toLocaleString() : 'Just now';
                    const userName = c.userName || `User ${c.userID.substring(0, 6)}`; // Fallback for old comments
                    return `
                        <div class="border-l-2 pl-3" style="border-color: var(--c-accent-2);">
                            <p class="leading-relaxed">${c.text}</p>
                            <p class="text-sm opacity-60 mt-1">
                                <strong>${userName}</strong> – <span class="text-xs">${time}</span>
                            </p>
                        </div>
                    `;
                }).join('');
            }

            // --- FEEDBACK/SUBMISSION FUNCTIONS ---

            async function postReview() {
                if (!currentUserId) {
                    console.error("Login first!");
                    return;
                }
                const text = reviewText.value;
                if (!text.trim()) {
                    reviewMessage.textContent = "Please enter some feedback.";
                    reviewMessage.style.color = "var(--c-highlight)";
                    return;
                }

                try {
                    // Correct Firestore Path (Private to user)
                    await addDoc(collection(db, "artifacts", appId, "users", currentUserId, "reviews"), {
                        text: text,
                        createdAt: serverTimestamp()
                    });
                    reviewText.value = "";
                    reviewMessage.textContent = "Thank you for your feedback!";
                    reviewMessage.style.color = "var(--c-accent-1)";
                    setTimeout(() => reviewMessage.textContent = "", 3000);
                } catch (e) {
                    console.error("Error posting review: ", e);
                    reviewMessage.textContent = "Error submitting. Please try again.";
                    reviewMessage.style.color = "var(--c-highlight)";
                }
            }

            async function postSubmission() {
                if (!currentUserId) {
                    console.error("Login first!");
                    return;
                }
                const title = submissionTitle.value;
                const content = submissionContent.value;
                
                if (!title.trim() || !content.trim()) {
                    submissionMessage.textContent = "Please fill out both title and content.";
                    submissionMessage.style.color = "var(--c-highlight)";
                    return;
                }

                try {
                    // Correct Firestore Path (Private to user)
                    await addDoc(collection(db, "artifacts", appId, "users", currentUserId, "submissions"), {
                        title: title,
                        content: content,
                        createdAt: serverTimestamp()
                    });
                    submissionTitle.value = "";
                    submissionContent.value = "";
                    submissionMessage.textContent = "Your whisper has been received. Thank you!";
                    submissionMessage.style.color = "var(--c-accent-1)";
                    setTimeout(() => submissionMessage.textContent = "", 3000);
                } catch (e) {
                    console.error("Error posting submission: ", e);
                    submissionMessage.textContent = "Error submitting. Please try again.";
                    submissionMessage.style.color = "var(--c-highlight)";
                }
            }


            // --- EVENT LISTENERS ---
            modalCloseBtn.addEventListener('click', () => {
                modal.classList.remove('visible');
                currentOpenPoemId = null;
                // Detach real-time listeners for modal
                if (likesUnsubscribe) likesUnsubscribe();
                if (commentsUnsubscribe) commentsUnsubscribe();
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('visible');
                    currentOpenPoemId = null;
                    // Detach real-time listeners for modal
                    if (likesUnsubscribe) likesUnsubscribe();
                    if (commentsUnsubscribe) commentsUnsubscribe();
                }
            });
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetElement = document.querySelector(this.getAttribute('href'));
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                }); 
            });
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    topNav.classList.add('scrolled');
                } else {
                    topNav.classList.remove('scrolled');
                }
            });

            // --- INITIALIZATION ---
            function init() {
                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Attach login/logout to buttons in nav
                loginBtn.addEventListener('click', googleLogin);
                logoutBtn.addEventListener('click', googleLogout);

                // Attach feedback listeners
                postReviewBtn.addEventListener('click', postReview);
                postSubmissionBtn.addEventListener('click', postSubmission);

                // Initial Renders
                renderFilters();
                renderPoemsGrid();
                renderThemeToggle();
                themeToggleButton.addEventListener('click', toggleTheme);

                // Attach auth listener AFTER auth is initialized
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // User is signed in
                        currentUserId = user.uid;
                        currentUserName = user.displayName.split(' ')[0]; // Get first name
                        userName.textContent = `Hi, ${currentUserName}`;
                        navAuth.classList.add('signed-in');

                        // Show feedback forms
                        feedbackAuthPrompt.classList.add('hidden');
                        feedbackForms.classList.remove('hidden');

                        // --- Load user's favorites in real-time ---
                        const userRef = doc(db, "artifacts", appId, "users", user.uid);
                        
                        // Detach any old listener before attaching a new one
                        if (userFavoritesUnsubscribe) {
                            userFavoritesUnsubscribe();
                        }

                        userFavoritesUnsubscribe = onSnapshot(userRef, (docSnap) => {
                            if (docSnap.exists() && docSnap.data().favoritePoemIds) {
                                favoritePoemIds = docSnap.data().favoritePoemIds.map(id => parseInt(id));
                            } else {
                                favoritePoemIds = [];
                            }
                            // Re-render grid in case 'Favorites' filter is active
                            renderPoemsGrid();
                        }, (error) => {
                            console.error("Error listening to user favorites: ", error);
                        });

                    } else {
                        // User is signed out
                        currentUserId = null;
                        currentUserName = null;
                        userName.textContent = '';
                        navAuth.classList.remove('signed-in');
                        favoritePoemIds = []; // Clear local favorites

                        // Hide feedback forms
                        feedbackAuthPrompt.classList.remove('hidden');
                        feedbackForms.classList.add('hidden');

                        // Detach the favorites listener
                        if (userFavoritesUnsubscribe) {
                            userFavoritesUnsubscribe();
                            userFavoritesUnsubscribe = null;
                        }
                    }
                    // Update comment form visibility if modal is open
                    checkAuthForComments(user);
                    // Re-load likes/favorites to check user's status
                    if(currentOpenPoemId) {
                        loadLikes(currentOpenPoemId);
                        loadFavoriteStatus(currentOpenPoemId, user);
                    }
                });
            }

            init();
        });
    </script>

    <style>
        /* --- Custom Styles & Theming --- */
        :root {
            /* ☀️ Light Mode: “Earthbound Elegance” */
            --light-bg: #FFF9F2;
            --light-text: #3B2F2F;
            --light-accent-1: #A67C52;
            --light-accent-2: #D4BFAA;
            --light-highlight: #6B4226;

            /* 🌙 Dark Mode: “Sepia Eclipse” */
            --dark-bg: #1C1A18;
            --dark-text: #E8DCCF;
            --dark-accent-1: #A67C52;
            --dark-accent-2: #533C2C;
            --dark-highlight: #E2B27E;
            
            --c-bg: var(--light-bg);
            --c-text: var(--light-text);
            --c-accent-1: var(--light-accent-1);
            --c-accent-2: var(--light-accent-2);
            --c-highlight: var(--light-highlight);
        }

        html.dark {
             --c-bg: var(--dark-bg);
             --c-text: var(--dark-text);
             --c-accent-1: var(--dark-accent-1);
             --c-accent-2: var(--dark-accent-2); 
             --c-highlight: var(--dark-highlight);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            transition: background-color 0.5s, color 0.5s;
        }

        /* --- Font Families --- */
        .font-headline { font-family: 'Playfair Display', serif; }
        .font-body { font-family: 'Raleway', sans-serif; }
        .font-name { font-family: 'Cinzel Decorative', serif; }
        .font-writing { font-family: 'Lora', serif; }

        /* --- Animations --- */
        @keyframes fade-in-up { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        .fade-in-up { 
            animation: fade-in-up 0.8s ease-out forwards; 
            opacity: 0;
        }
        .fade-in-up-delay-1 { animation-delay: 0.2s; }
        .fade-in-up-delay-2 { animation-delay: 0.4s; }
        .fade-in-up-delay-3 { animation-delay: 0.6s; }

        /* --- Theme Transition --- */
        body.theme-transition {
            transition: filter 0.5s ease-in-out;
            filter: blur(5px);
        }
        
        /* --- Gallery Card --- */
        .poem-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .poem-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        html.dark .poem-card:hover {
             box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        /* --- Modal --- */
        #quick-preview-modal {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #quick-preview-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #quick-preview-modal .modal-content {
            transition: transform 0.4s ease-out;
            transform: scale(0.95);
        }
        #quick-preview-modal.visible .modal-content {
            transform: scale(1);
        }
        
        .favorite-btn .heart-filled {
            color: var(--c-highlight);
        }
        
        /* --- Sticky Nav --- */
        #top-nav {
            background-color: transparent;
            transition: background-color 0.3s ease;
        }
        #top-nav.scrolled {
            background-color: var(--c-bg);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        html.dark #top-nav.scrolled {
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        /* --- Auth Buttons --- */
        #nav-auth #login-btn { display: inline-block; }
        #nav-auth #user-info,
        #nav-auth #logout-btn { display: none; }
        
        #nav-auth.signed-in #login-btn { display: none; }
        #nav-auth.signed-in #user-info,
        #nav-auth.signed-in #logout-btn { display: inline-block; }

        /* --- Feedback Forms --- */
        .feedback-form-field {
            background-color: var(--c-bg); 
            border-color: var(--c-accent-2); 
            color: var(--c-text); 
            --tw-ring-color: var(--c-accent-1);
        }
        .feedback-form-field:focus {
            background-color: var(--c-bg);
        }
        /* Fix for autofill background */
        input:-webkit-autofill,
        textarea:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 50px var(--c-bg) inset !important;
            -webkit-text-fill-color: var(--c-text) !important;
        }

    </style>
</head>
<body class="font-body">

    <!-- STICKY NAV -->
    <nav id="top-nav" class="fixed top-0 left-0 right-0 py-4 px-4 md:px-8 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="#about" class="font-headline text-2xl font-bold" style="color: var(--c-accent-1);">Timeless Whispers</a>
            <div class="flex items-center gap-4 md:gap-6">
                <a href="#journal" class="font-body text-sm hover:text-[var(--c-highlight)] transition-colors">Journal</a>
                <a href="#gallery" class="font-body text-sm hover:text-[var(--c-highlight)] transition-colors">Gallery</a>
                <a href="#connect" class="font-body text-sm hover:text-[var(--c-highlight)] transition-colors">Connect</a>
                <div id="nav-auth" class="flex items-center gap-2 md:gap-4 pl-2 md:pl-4 border-l" style="border-color: var(--c-accent-2);">
                    <span id="user-info" class="text-sm">
                        <span id="user-name" class="font-bold"></span>
                    </span>
                    <button id="login-btn" class="font-bold py-2 px-4 rounded-full text-sm transition-all" style="background-color: var(--c-accent-1); color: var(--c-bg);">Sign In With Google</button>
                    <button id="logout-btn" class="font-bold text-sm opacity-70 hover:opacity-100">Sign Out</button>
                </div>
            </div>
        </div>
    </nav>

    <main>
        
        <!-- ABOUT ME (CINEMATIC HERO) -->
        <section id="about" class="min-h-screen flex items-center justify-center relative p-8 text-center text-white" style="background-image: url('https://images.unsplash.com/photo-1455390582262-044cdead277a?q=80&w=1973&auto=format&fit=crop'); background-size: cover; background-position: center; background-color: var(--dark-bg);">
            <div class="absolute inset-0 bg-black/60 z-10"></div>
            <div class="relative z-20 max-w-3xl mx-auto px-4 fade-in-up">
                 <h2 class="font-headline text-5xl md:text-7xl font-bold" style="color: var(--dark-highlight)">This is me, unfiltered.</h2>
                 <p class="mt-6 opacity-90 leading-relaxed text-lg md:text-xl">I’m Max—a wordsmith on a mission to turn life into poetry! Every line I write is fueled by love, heartbreak, and the crazy twists and turns of this beautiful chaos we call life.<br><br>I don’t just write poems; I create moments, feelings, and stories that stick with you. Whether it’s finding light in the dark or chasing dreams that set your soul on fire, my poetry is here to vibe with yours.<br><br>Dive in, feel the rhythm, and let’s turn life into poetry together!</p>
                 <a href="#gallery" class="inline-block mt-8 font-bold text-lg transition-colors duration-300 border-2 py-3 px-6 rounded-full" style="border-color: var(--dark-accent-1); color: var(--dark-accent-1); backdrop-filter: blur(5px);">
                    [ Read the Collection ]
                 </a>
            </div>
        </section>

        <!-- POET'S JOURNAL (INTERLUDE) -->
        <section id="journal" class="min-h-screen py-20 px-4 md:px-8 flex items-center justify-center" style="background-color: var(--dark-bg); color: var(--dark-text);">
            <div class="max-w-3xl mx-auto text-center fade-in-up">
                <h2 class="font-headline text-4xl font-bold" style="color: var(--dark-highlight)">Poet’s Journal</h2>
                <p class="mt-2 mb-12 opacity-70">Short writings, reflections, or the stories behind the poems.</p>
                <div class="text-left grid grid-cols-1 gap-12">
                    <div class="border-l-2 pl-6" style="border-color: var(--dark-accent-2)">
                        <h3 class="font-headline text-2xl font-bold" style="color: var(--dark-accent-1)">An Open Book</h3>
                        <p class="mt-2 opacity-80 font-writing text-lg">I write for everyone. There are no "letters I never sent" here, no hidden diaries. My work is an open book, a conversation with the world. Each poem is a piece of my soul, offered freely, hoping to find a connection in yours.</p>
                    </div>
                    <div class="border-l-2 pl-6" style="border-color: var(--dark-accent-2)">
                        <h3 class="font-headline text-2xl font-bold" style="color: var(--dark-accent-1)">On Finding Hope in Chaos</h3>
                        <p class="mt-2 opacity-80 font-writing text-lg">It's easy to write about storms, but what about the first ray of light that breaks through? This is a reflection on capturing that fleeting moment of optimism when all seems lost...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- EMOTION GALLERY -->
        <section id="gallery" class="min-h-screen py-20 px-4 md:px-8 flex items-center">
            <div class="max-w-6xl w-full mx-auto">
                <h2 class="font-headline text-4xl text-center font-bold" style="color: var(--c-highlight)">Read what your heart needs.</h2>
                <div id="emotion-filters" class="flex flex-wrap justify-center gap-2 md:gap-4 my-8">
                    <!-- Filters will be injected here -->
                </div>
                <div id="poems-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Poem cards will be injected here -->
                </div>
            </div>
        </section>

        <!-- CONNECT / SUBSCRIBE -->
        <section id="connect" class="min-h-screen py-20 px-4 flex items-center justify-center bg-black/5 dark:bg-white/5">
            <div class="max-w-4xl mx-auto w-full">
                <h2 class="font-headline text-3xl font-bold text-center" style="color: var(--c-accent-1)">Join the Conversation</h2>
                <p class="mt-2 mb-8 opacity-70 text-center">Your feedback shapes this space. Share your thoughts or your own words.</p>
                
                <div id="feedback-auth-prompt" class="text-center">
                    <p class="opacity-80">
                        <button class="font-bold underline" style="color: var(--c-accent-1);" onclick="googleLogin()">Sign in</button> to share feedback or submit your own poem.
                    </p>
                </div>

                <div id="feedback-forms" class="hidden grid grid-cols-1 md:grid-cols-2 gap-12">
                    <!-- Review Form -->
                    <div>
                        <h3 class="font-headline text-2xl font-bold mb-4" style="color: var(--c-highlight)">Leave a Review</h3>
                        <p class="text-sm opacity-60 mb-4">Have feedback, suggestions, or ideas for how I can develop this site? Let me know!</p>
                        <textarea id="review-text" placeholder="Your thoughts..." rows="5" class="w-full p-3 rounded-lg border-2 focus:ring-2 outline-none transition-shadow feedback-form-field"></textarea>
                        <button id="post-review-btn" class="mt-2 font-bold py-2 px-5 rounded-full shadow-lg hover:opacity-90 transition-all text-sm" style="background-color: var(--c-accent-1); color: var(--c-bg);">Send Feedback</button>
                        <p id="review-message" class="text-sm mt-2 font-bold"></p>
                    </div>
                    
                    <!-- Submission Form -->
                    <div>
                        <h3 class="font-headline text-2xl font-bold mb-4" style="color: var(--c-highlight)">Share Your Whisper</h3>
                        <p class="text-sm opacity-60 mb-4">Want to submit your own poem for review? I'd be honored to read it.</p>
                        <input type="text" id="submission-title" placeholder="Poem Title" class="w-full p-3 mb-2 rounded-lg border-2 focus:ring-2 outline-none transition-shadow feedback-form-field">
                        <textarea id="submission-content" placeholder="Your poem..." rows="8" class="w-full p-3 rounded-lg border-2 focus:ring-2 outline-none transition-shadow feedback-form-field"></textarea>
                        <button id="post-submission-btn" class="mt-2 font-bold py-2 px-5 rounded-full shadow-lg hover:opacity-90 transition-all text-sm" style="background-color: var(--c-accent-1); color: var(--c-bg);">Submit Poem</button>
                        <p id="submission-message" class="text-sm mt-2 font-bold"></p>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="py-12 text-center border-t" style="border-color: var(--c-accent-2);">
        <div class="flex justify-center gap-6 mb-4">
            <a href="#about" class="hover:text-[var(--c-highlight)] transition-colors">About</a>
            <a href="#journal" class="hover:text-[var(--c-highlight)] transition-colors">Journal</a>
            <a href="#gallery" class="hover:text-[var(--c-highlight)] transition-colors">Poems</a>
            <a href="#connect" class="hover:text-[var(--c-highlight)] transition-colors">Contact</a>
        </div>
        <p class="italic opacity-60">“Some poems aren't just read — they're felt.”</p>
        <p class="text-sm mt-4 opacity-50">&copy; 2025 Timeless Whispers. All Rights Reserved.</p>
    </footer>

    <!-- QUICK PREVIEW MODAL -->
    <div id="quick-preview-modal" class="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-[60] opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="modal-content w-full max-w-2xl max-h-[80vh] overflow-y-auto p-8 md:p-12 rounded-lg shadow-2xl relative z-[60]" style="background-color: var(--c-bg);">
            <button id="modal-close-btn" class="absolute top-4 right-4 text-2xl opacity-50 hover:opacity-100 transition-opacity" style="color: var(--c-text)">&times;</button>
            <div id="modal-poem-content"></div>
        </div>
    </div>
    
    <!-- THEME TOGGLE BUTTON -->
    <button id="theme-toggle" class="fixed top-6 right-6 w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg z-50" style="background-color: var(--c-accent-2); color: var(--c-text);">
        <!-- Icon will be injected here -->
    </button>
    
</body>
</html>

